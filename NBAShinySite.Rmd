---
title: "NBA Player Data"
output:
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: cyborg
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(hoopR)
library(sportyR)
library(tictoc)
library(ggplot2)
library(janitor)
library(stringr)
library(readr)
library(plotly)
mean_shot <- read_csv("mean_shot.csv")
season25 <- read_csv("season25.csv")
team_stats <- read_csv("team_stats.csv")
```

# About

## Column {data-width = 200}

**Authors**

Noah Jansen and Mitch Thronson

**Background Information**

This project aims to examine some of the player and team statistics for NBA players in the 2024-2025 NBA regular season. While looking at player's game statistics, we also plan to examine their shot map data to identify importance within their shooting.

Player and team data was collected from [Basketball Reference](https://www.basketball-reference.com) and shot data was downloaded via the [hoopR](https://hoopr.sportsdataverse.org) package.

**Github Code**

How did we do it? Check it out [here](https://github.com/Noahmj123/sds264proj).

## Column {data-width = 200}

```{r, echo=FALSE}

renderImage({
    list(src = "nbalogo.png",
         alt = "This is alternate text", width = 600, height = 400)
  })
```

# Shot Distance

```{r, include = FALSE}
tictoc::tic()
progressr::with_progress({
  nba_pbp <- hoopR::load_nba_pbp(seasons = 2025)
})
tictoc::toc()

shot_map <- nba_pbp |>
  filter(shooting_play == "TRUE") |>
  rename(result = scoring_play) |>
  filter(!str_detect(text, "blocks")) |>
  mutate(result = ifelse(result == TRUE, "make", "miss"), player_n = str_extract(text, "^[^ ]+ [^ ]+(?: Jr\\.)?")) |>
  select(player_n, coordinate_x, coordinate_y, result) |>
  filter(player_n %in% season25$player | player_n %in% c("Bogdan Bogdanovic", "Luka Doncic", "Nikola Jokic", "Alperen Sengun", "Dennis Schroder", "Nikola Vucevic", "Nikola JoviÄ‡")) |>
  mutate(coordinate_x = abs(coordinate_x)) |>
    filter(coordinate_x != 28 & coordinate_y != 0)

shot_map <- shot_map |>
  mutate(x_ft = abs((41.75-coordinate_x)*(15/13.75)), y_ft = abs(coordinate_y)*(15/13.75)) |>
  mutate(shot_dist_ft = sqrt(x_ft^2 + y_ft^2))

players <- shot_map |>
  group_by(player_n) |>
  summarize(n = n()) |>
  select(player_n) |>
  mutate(last = str_remove(player_n, "^.* "))

mean_shot <- mean_shot |>
  mutate(last = str_remove(player_n, "^.* "))
```

## Column

### Player Average Shot Distance (ft)

```{r echo = FALSE}
inputPanel(
  selectInput("distg", label = "Sort By:",
              choices = c("High to Low", "Low to High", "A-Z", "Z-A"), selected = "High to Low")
)

renderTable({
 if(input$distg == "High to Low")
  mean_shot |>
    arrange(-mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
  else if(input$distg == "Low to High")
  mean_shot |>
    arrange(mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
  else if(input$distg == "A-Z")
  mean_shot |>
    arrange(last) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
  else if(input$distg == "Z-A")
  mean_shot |>
    arrange(desc(last)) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
})
```

## Column

### Player Shot Chart

```{r echo = FALSE}
inputPanel(
  selectInput("playr", label = "Player",
              choices = players$player_n)
)

renderPlot({
  playd <-shot_map |>
    filter(player_n == input$playr)
  
geom_basketball(league = "NBA", display_range = "offense", rotation = 270) +
geom_point(data = playd, aes(x = coordinate_y, y = -coordinate_x, color = result), show.legend = FALSE) +
  scale_colour_manual(values = c("green", "red")) +
  theme(legend.key = element_blank(), 
        plot.background = element_rect(fill = "black", color = "black"),
        panel.background = element_rect(fill = "black",color = "black"),
        plot.margin = margin(t = 20,
                             r = 50,
                             b = 40,
                             l = 10)) +
  theme_void()#gets rid of axis and lines
})
```

# Teams

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput("group_choice", label = "Analyze by:",
              choices = c("Points", "Rating"), selected = "Rating")
)
```

## Column



### Team Ratings and Points

```{r echo = FALSE}
df_line <- data.frame(
      x_line = 1:200,
      y_line = 1:200
    )

renderPlotly({
  if(input$group_choice == "Points")
team_stats |>
plot_ly(x = ~points_per_g, y = ~opp_points_per_g, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |>
      layout(xaxis = list(title = "Team Points Per Game"),
             yaxis = list(title = "Team Points Allowed Per Game"))
  else if(input$group_choice == "Rating")
team_stats |>
plot_ly(x = ~off_rating, y = ~-def_rating, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |>
      layout(xaxis = list(title = "Team Offensive Rating"),
             yaxis = list(title = "Team Defensive Rating (Inverse)"))
      
})
```

# Rank to Record

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput("x_axis", label = "X-axis variable:",
              choices = c("TBD", "Not sure yet.."), selected = "TBD")
)
```

