---
title: "NBA Player Data"
output:
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: cyborg
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sportyR)
library(tictoc)
library(ggplot2)
library(janitor)
library(stringr)
library(readr)
library(plotly)
library(ggridges)
library(flexdashboard)
library(dplyr)
mean_shot <- read_csv("mean_shot.csv")
season25 <- read_csv("season25.csv")
team_stats <- read_csv("team_stats.csv") |>
  mutate(net_wins = wins - losses)
shot_map <- read_csv("shot_map.csv")
```

# About

## Column {data-width = 200}

**Authors**

Noah Jansen and Mitch Thronson

**Background Information**

This project aims to examine some of the player and team statistics for NBA players in the 2024-2025 NBA regular season. While looking at player's game statistics, we also plan to examine their shot map data to identify importance within their shooting.

Player and team data was collected from [Basketball Reference](https://www.basketball-reference.com) and shot data was downloaded via the [hoopR](https://hoopr.sportsdataverse.org) package.

**Github Code**

How did we do it? Check it out [here](https://github.com/Noahmj123/sds264proj).

## Column {data-width = 200}

```{r, echo=FALSE}

renderImage({
    list(src = "nbalogo.png",
         alt = "This is alternate text", width = 600, height = 400)
  })
```

# Shot Distance

```{r, include = FALSE}
players <- shot_map |> #makes player name list
  group_by(player_n) |>
  summarize(n = n()) |>
  select(player_n) |>
  mutate(last = str_remove(player_n, "^.* ")) #grabs last name

mean_shot <- mean_shot |>
  mutate(last = str_remove(player_n, "^.* "))
```

## Column

### Player Average Shot Distance (ft)

```{r echo = FALSE}
inputPanel(
  selectInput("distg", label = "Sort By:",
              choices = c("High to Low", "Low to High", "A-Z", "Z-A"), selected = "High to Low")
) # Drop down menu for sorting table

```

```{r echo = FALSE}
renderTable({
 if(input$distg == "High to Low")
  mean_shot |>
    arrange(-mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |> #Gives good table names
    select(-last) |>
    slice(1:50)
  else if(input$distg == "Low to High")
  mean_shot |>
    arrange(mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last) |>
    slice(1:50)
  else if(input$distg == "A-Z")
  mean_shot |>
    arrange(last) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last) |>
    slice(1:50)
  else if(input$distg == "Z-A")
  mean_shot |>
    arrange(desc(last)) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last) |>
    slice(1:50)
})
```

Column {.tabset}
-------------------------------------

### Player Shot Chart

```{r echo = FALSE}
inputPanel( #input for individual players
  selectInput("playr", label = "Player",
              choices = players$player_n)
)

```

```{r, echo = FALSE, fig.height=20}

renderPlot({
  playd <-shot_map |> 
    filter(player_n == input$playr) # grabs only player selected

geom_basketball(league = "NBA", display_range = "offense", rotation = 270) +
geom_point(data = playd, aes(x = coordinate_y, y = -coordinate_x, color = result), show.legend = FALSE) +
  scale_colour_manual(values = c("green", "red")) + #makes and misses colors coordinated
  theme(legend.key = element_blank(), 
        plot.background = element_rect(fill = "black", color = "black"), # smooths out plot edges
        panel.background = element_rect(fill = "black",color = "black"),
        plot.margin = margin(t = 20,
                             r = 50,
                             b = 40,
                             l = 10)) +
    theme_void() #gets rid of axis and lines


})


```

### Free Throw

```{r echo = FALSE}
inputPanel( # select individual player
  selectInput("playr2", label = "Player",
              choices = players$player_n)
)

```

```{r echo = FALSE}

meanseason25 <- season25 |> 
mutate(player = case_when( #adds back players with non english alphabet letters
    player == "Bogdan Bogdanović" ~ "Bogdan Bogdanovic",
    player == "Luka Dončić" ~ "Luka Doncic",
    player == "Nikola Jokić" ~ "Nikola Jokic",
    player == "Alperen Şengün" ~ "Alperen Sengun",
    player == "Dennis Schröder" ~ "Dennis Schroder",
    player == "Nikola Vučević" ~ "Nikola Vucevic",
    player == "Nikola Jović" ~ "Nikola Jovic",
    player == "Kristaps Porziņģis" ~ "Kristaps Porzingis",
    TRUE ~ player)) |>
    left_join(mean_shot, by = join_by(player == player_n)) #

hline <- list( # adds line of free throw length
  type = "line",
  x0 = 0,
  x1 = 1,
  xref = "paper",
  y0 = 15, 
  y1 = 15, 
  yref = "y",
  line = list(color = "red", dash = "dash", width = 2)
)

renderPlotly({  #interactive plot function
  
meanplayer <- meanseason25 |>
    filter(player == input$playr2) 
  
meanseason25|>
plot_ly(x = ~free_throw_percent, y = ~mean_shot_ft, type = 'scatter', mode = 'markers', text = ~paste("Player: ", player, '<br>Team: ', team)) |>
      layout(xaxis = list(title = "Free Throw Percentage"),
             yaxis = list(title = "Average Shot Distance (ft)"),
             shapes = hline,
             showlegend = FALSE) |>
    add_trace(x = meanplayer$free_throw_percent, y = meanplayer$mean_shot_ft, type = "scatter", mode = "markers", color = I("red"), inherit = FALSE, name = "Player") #inputs free throw line length

})
```


# Teams

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel( # select tool for scatterplot
  selectInput("group_choice", label = "Analyze by:",
              choices = c("Points", "Rating"), selected = "Rating")
)
```

## Column



### Team Ratings and Points

```{r echo = FALSE}

renderPlotly({
  if(input$group_choice == "Points") # select option 1
team_stats |>
plot_ly(x = ~points_per_g, y = ~opp_points_per_g, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |>
      layout(xaxis = list(title = "Team Points Per Game"),
             yaxis = list(title = "Team Points Allowed Per Game"))
  else if(input$group_choice == "Rating") #select option 2
team_stats |>
plot_ly(x = ~off_rating, y = ~-def_rating, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |>
      layout(xaxis = list(title = "Team Offensive Rating"),
             yaxis = list(title = "Team Defensive Rating (Inverse)"))
      
})
```

# Rank to Record

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput("x_axis", label = "X-axis variable:",
              choices = c("Team Points Per Game",
                          "Points Allowed Per Game",
                          "Team Offensive Rating",
                          "Team Defensive Rating (Inverse)"), 
              selected = "Team Points Per Game")
)
```

## Column

### Team Stats Against Net Wins

```{r, echo=FALSE}
renderPlotly({
  if (input$x_axis == "Team Points Per Game")
team_stats |>
plot_ly(x = ~points_per_g, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Points Per Game: ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Points Per Game"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Points Allowed Per Game")
team_stats |>
plot_ly(x = ~opp_points_per_g, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Points Allowed Per Game: ", points_per_g, "<br>Net Wins", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Points Allowed Per Game"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Team Offensive Rating")
team_stats |>
plot_ly(x = ~off_rating, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Offensive Rating: ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Offensive Rating"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Team Defensive Rating (Inverse)")
team_stats |>
plot_ly(x = ~-def_rating, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Defensive Rating (Inverse): ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Defensive Rating"),
           yaxis = list(title = "Net Wins"))
})
```

# Player Distribution

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput("player_stat", label = "Player Statistic:",
              choices = c("Field Goal Percentage",
                          "Three Point Percentage",
                          "Two Point Percentage",
                          "Free Throw Percentage",
                          "Total Rebounds",
                          "Assists",
                          "Steals",
                          "Blocks",
                          "Turnovers",
                          "Points"), 
              selected = "Field Goal Percentage")
)
```

## Column

### Distribution of Player Stats by Position

```{r, echo=FALSE}

season25$position <- factor(season25$position, levels = c("C", "PF", "SF", "SG", "PG"))

renderPlot ({
  if (input$player_stat == "Field Goal Percentage")
    ggplot(season25, aes(x = field_goal_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Field Goal Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Three Point Percentage")
    ggplot(season25, aes(x = three_point_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Three Point Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Two Point Percentage")
    ggplot(season25, aes(x = two_point_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Two Point Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Free Throw Percentage")
    ggplot(season25, aes(x = free_throw_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Free Throw Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Total Rebounds")
    ggplot(season25, aes(x = total_rebounds, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Total Rebounds",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Assists")
    ggplot(season25, aes(x = assists, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Assists",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Steals")
    ggplot(season25, aes(x = steals, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Steals",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Blocks")
    ggplot(season25, aes(x = blocks, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Blocks",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Turnovers")
    ggplot(season25, aes(x = turnovers, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Turnovers",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Points")
    ggplot(season25, aes(x = points, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Points",
      y = "Position"
    ) +
    theme(legend.position = "none")
})
```

# Conclusions