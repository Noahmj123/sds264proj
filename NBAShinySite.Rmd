---
title: "NBA Player Data"
output:
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: cyborg
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sportyR)
library(tictoc)
library(ggplot2)
library(janitor)
library(stringr)
library(readr)
library(plotly)
library(ggridges)
library(flexdashboard)
library(dplyr)
mean_shot <- read_csv("mean_shot.csv")
season25 <- read_csv("season25.csv")
team_stats <- read_csv("team_stats.csv") |>
  mutate(net_wins = wins - losses)
shot_map <- read_csv("shot_map.csv")
```

# About

## Column {data-width = 200}

**Authors**

Noah Jansen and Mitch Thronson

**Background Information**

This project aims to examine some of the player and team statistics for NBA players in the 2024-2025 NBA regular season. While looking at player's game statistics, we also plan to examine their shot map data to identify importance within their shooting.

Player and team data was collected from [Basketball Reference](https://www.basketball-reference.com) and shot data was downloaded via the [hoopR](https://hoopr.sportsdataverse.org) package.

**Github Code**

How did we do it? Check it out [here](https://github.com/Noahmj123/sds264proj).

## Column {data-width = 200}

```{r, echo=FALSE}

renderImage({
    list(src = "nbalogo.png",
         alt = "This is alternate text", width = 600, height = 400)
  })
```

# Shot Distance

```{r, include = FALSE}
players <- shot_map |> #makes player name list
  group_by(player_n) |>
  summarize(n = n()) |>
  select(player_n) |>
  mutate(last = str_remove(player_n, "^.* "))#grabs last name

mean_shot <- mean_shot |>
  mutate(last = str_remove(player_n, "^.* "))
```

## Column

### Player Average Shot Distance (ft)

```{r echo = FALSE}
inputPanel(
  selectInput("distg", label = "Sort By:",
              choices = c("High to Low", "Low to High", "A-Z", "Z-A"), selected = "High to Low")
)
# Drop down menu for sorting table
```

```{r echo = FALSE}
renderTable({
 if(input$distg == "High to Low")
  mean_shot |>
    arrange(-mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |> #Gives good table names
    select(-last)
  else if(input$distg == "Low to High")
  mean_shot |>
    arrange(mean_shot_ft) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
  else if(input$distg == "A-Z")
  mean_shot |>
    arrange(last) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
  else if(input$distg == "Z-A")
  mean_shot |>
    arrange(desc(last)) |>
    rename(Player = player_n, "Average Shot(ft)" = mean_shot_ft) |>
    select(-last)
})
```

Column {.tabset}
-------------------------------------

### Player Shot Chart

```{r echo = FALSE}
inputPanel( #input for individual players
  selectInput("playr", label = "Player",
              choices = players$player_n)
)

```

```{r, echo = FALSE, fig.height=6}

renderPlot({
  playd <-shot_map |> # grabs only player selected
    filter(player_n == input$playr)

geom_basketball(league = "NBA", display_range = "offense", rotation = 270) +
geom_point(data = playd, aes(x = coordinate_y, y = -coordinate_x, color = result), show.legend = FALSE) +
  scale_colour_manual(values = c("green", "red")) + #makes and misses colors coordinated
  theme(legend.key = element_blank(), 
        plot.background = element_rect(fill = "black", color = "black"), # smooths out plot edges
        panel.background = element_rect(fill = "black",color = "black"),
        plot.margin = margin(t = 20,
                             r = 50,
                             b = 40,
                             l = 10)) +
  theme_void()#gets rid of axis and lines

})


```

### Free Throw

```{r echo = FALSE}
inputPanel( #input for individual players
  selectInput("playr2", label = "Player",
              choices = players$player_n)
)

```


```{r echo = FALSE}

meanseason25 <- season25 |> 
mutate(player = case_when( #adds back players with non english alphabet letters
    player == "Bogdan Bogdanović" ~ "Bogdan Bogdanovic",
    player == "Luka Dončić" ~ "Luka Doncic",
    player == "Nikola Jokić" ~ "Nikola Jokic",
    player == "Alperen Şengün" ~ "Alperen Sengun",
    player == "Dennis Schröder" ~ "Dennis Schroder",
    player == "Nikola Vučević" ~ "Nikola Vucevic",
    player == "Nikola Jović" ~ "Nikola Jovic",
    player == "Kristaps Porziņģis" ~ "Kristaps Porzingis",
    TRUE ~ player)) |>
    left_join(mean_shot, by = join_by(player == player_n))

hline <- list( # adds line of free throw length
  type = "line",
  x0 = 0,
  x1 = 1,
  xref = "paper",
  y0 = 15, 
  y1 = 15, 
  yref = "y",
  line = list(color = "red", dash = "dash", width = 2)
)

renderPlotly({ #interactive plot function
  
meanplayer <- meanseason25 |>
    filter(player == input$playr2)
  
meanseason25|>
plot_ly(x = ~free_throw_percent, y = ~mean_shot_ft, type = 'scatter', mode = 'markers', text = ~paste("Player: ", player, '<br>Team: ', team)) |>
      layout(xaxis = list(title = "Free Throw Percentage"),
             yaxis = list(title = "Average Shot Distance (ft)"),
             shapes = hline,
             showlegend = FALSE) |>
    add_trace(x = meanplayer$free_throw_percent, y = meanplayer$mean_shot_ft, type = "scatter", mode = "markers", color = I("red"), inherit = FALSE, name = "Player") #inputs free throw line length

})
```


# Teams

## Inputs {.sidebar}

```{r, echo=FALSE}
#input panel that lets user choose between points scored vs. allowed or offensive rating vs. defensive rating (inverse)
inputPanel( # select tool for scatterplot
  selectInput("group_choice", label = "Analyze by:",
              choices = c("Points", "Rating"), selected = "Rating")
)
```

## Column

### Team Ratings and Points

```{r echo = FALSE}

renderPlotly({
#conditional plot that changes what it displays based on the choice from the input panel above
  if(input$group_choice == "Points")
team_stats |>
plot_ly(x = ~points_per_g, y = ~opp_points_per_g, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |> #win percentage calculated through taking the total number of wins and dividing that by 82
      layout(xaxis = list(title = "Team Points Per Game"),
             yaxis = list(title = "Team Points Allowed Per Game"))
  else if(input$group_choice == "Rating")
team_stats |>
plot_ly(x = ~off_rating, y = ~-def_rating, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, '<br>Win%: ', round(wins/82, digits = 3))) |>
      layout(xaxis = list(title = "Team Offensive Rating"),
             yaxis = list(title = "Team Defensive Rating (Inverse)"))
      
})
```

# Rank to Record

## Inputs {.sidebar}

```{r, echo=FALSE}
#input panel to choose which x-axis variable to compared to our y-axis variable net wins
inputPanel(
  selectInput("x_axis", label = "X-axis variable:",
              choices = c("Team Points Per Game",
                          "Points Allowed Per Game",
                          "Team Offensive Rating",
                          "Team Defensive Rating (Inverse)"), 
              selected = "Team Points Per Game")
)
```

## Column

### Team Stats Against Net Wins

```{r, echo=FALSE}
renderPlotly({
#conditional plot that changes what it displays based on the choice from the input panel above
  if (input$x_axis == "Team Points Per Game")
team_stats |>
plot_ly(x = ~points_per_g, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Points Per Game: ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Points Per Game"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Points Allowed Per Game")
team_stats |>
plot_ly(x = ~opp_points_per_g, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Points Allowed Per Game: ", points_per_g, "<br>Net Wins", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Points Allowed Per Game"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Team Offensive Rating")
team_stats |>
plot_ly(x = ~off_rating, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Offensive Rating: ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Offensive Rating"),
           yaxis = list(title = "Net Wins"))
  else if (input$x_axis == "Team Defensive Rating (Inverse)")
team_stats |>
plot_ly(x = ~-def_rating, y = ~net_wins, type = 'scatter', mode = 'markers', text = ~paste("Team: ", team, "<br>Team Defensive Rating (Inverse): ", points_per_g, "<br>Net Wins: ", net_wins, digits = 0)) |>
    layout(xaxis = list(title = "Team Defensive Rating"),
           yaxis = list(title = "Net Wins"))
})
```

# Player Distribution

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
#input panel to choose which stat to compare the distribution of by position
  selectInput("player_stat", label = "Player Statistic:",
              choices = c("Field Goal Percentage",
                          "Three Point Percentage",
                          "Two Point Percentage",
                          "Free Throw Percentage",
                          "Total Rebounds",
                          "Assists",
                          "Steals",
                          "Blocks",
                          "Turnovers",
                          "Points"), 
              selected = "Field Goal Percentage")
)
```

## Column

### Distribution of Player Stats by Position

```{r, echo=FALSE}
#reorders the names of the positions
season25$position <- factor(season25$position, levels = c("C", "PF", "SF", "SG", "PG"))

renderPlot ({
#conditional plot that changes what it displays based on the choice from the input panel above
  if (input$player_stat == "Field Goal Percentage")
    ggplot(season25, aes(x = field_goal_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Field Goal Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Three Point Percentage")
    ggplot(season25, aes(x = three_point_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Three Point Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Two Point Percentage")
    ggplot(season25, aes(x = two_point_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Two Point Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Free Throw Percentage")
    ggplot(season25, aes(x = free_throw_percent, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Free Throw Percentage",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Total Rebounds")
    ggplot(season25, aes(x = total_rebounds, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Total Rebounds",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Assists")
    ggplot(season25, aes(x = assists, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Assists",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Steals")
    ggplot(season25, aes(x = steals, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Steals",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Blocks")
    ggplot(season25, aes(x = blocks, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Blocks",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Turnovers")
    ggplot(season25, aes(x = turnovers, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Turnovers",
      y = "Position"
    ) +
    theme(legend.position = "none")
  else if (input$player_stat == "Points")
    ggplot(season25, aes(x = points, y = position, fill = position)) +
    geom_density_ridges() +
    labs(
      x = "Points",
      y = "Position"
    ) +
    theme(legend.position = "none")
})
```

# Conclusions

While our data dealt with a lot of the basics of NBA statistics, even scratching the surface can start to reveal some common trends in the data. It can be so easy to get lost with advanced statistics like True Shooting Percentage, Usage Rating, and PIE that people can forget how important and telling the basic statistics can be. Two teams that exceptionally stood out in this webpage are the Orlando Magic and the Oklahoma City Thunder. With OKC having been the NBA Champions of this year of statistics, it was no surprise to see them as the lead in almost every statistic, but it was shocking how far their gap truly was. They've already kept this dominance rolling into the current season as well, so in the coming years if they can maintain their core roster I think we are in the early stages of a dynasty. The Orlando Magic had the fourth lowest offensive efficiency in the league but maintained the second highest defensive efficiency, and an almost equal points per game and points allowed per game. With the NBA morphing more and more into an offensive heavy game its slightly refreshing to see a defensive heavy team still able to be playoff contenders and finish with a record of 0.500. Another interesting takeaway from our developments was how positively correlated shot distance and free throw percentage are. You would think players shooting from all distance need to have competence of shooting at the free throw line or that eventually it would kind of level out, but as players get more and more confident from distance they continue to shoot better from the line.

Our data was captured by scrapping from basketball reference as well as using the R package hoopR to obtain play-by-play data. Scrapping from basketball reference can be quite the pain to get specific statistics as basketball reference uses their own system to ID players, and with no easily accessible data set for those IDs most of them had to be recorded by hand to be scrapped. Because of this limitation, for the sake of time we only took 150 key players from the 2025 season so there are a lot of bench/role players who were not able to be included in the data. There was a similar problem with IDs for teams, but luckily a lot of them use the standard three letter code for teams (ex: MIN, SAC, DAL). If we were to revisit this project we would most likely include a bunch more statistics for teams as well as more advanced and obscure statistics for players. This would allow us to maybe try and categorize stronger predictors of specific variables in players. 

It's very satisfying to be able to select a specific player and see their shot map as well as the difference in statistics by position. This webpage allows a lot of insight for any basketball stat-head and shows some of the cool things that can be done with flexdashboards and shiny. We hope you enjoyed!
